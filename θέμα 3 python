#θεμα 3
import numpy as np
import pandas as pd
from sklearn.linear_model import LinearRegression
import matplotlib.pyplot as plt
# CSV
data = pd.read_csv("comdata.csv")
columns_to_keep = ["ViolentCrimesPerPop","medIncome","whitePerCap","blackPerCap","HispPerCap","NumUnderPov","PctUnemployed","HousVacant","MedRent","NumStreet"]
data = data[columns_to_keep]

# Καθαρισμός
data = data[~data.apply(lambda row: row.astype(str).str.contains(r'\?').any(), axis=1)]

# X, y
X = data[["medIncome","whitePerCap","blackPerCap","HispPerCap","NumUnderPov","PctUnemployed","HousVacant","MedRent","NumStreet"]].values
X = np.c_[np.ones((X.shape[0],1)), X]  # στήλη β0
y = data["ViolentCrimesPerPop"].values.reshape(-1,1)
#regression i)
dependentvars = data.loc[:,"ViolentCrimesPerPop"]
indexa = ["medIncome","whitePerCap","blackPerCap","HispPerCap","NumUnderPov","PctUnemployed","HousVacant","MedRent","NumStreet"]
independentvars = data.loc[:,indexa]
lm = LinearRegression(fit_intercept=True)
estimademodel = lm.fit(independentvars,dependentvars)
print("συντελεστες γραμμικης παλινδρομισης: ")
print(estimademodel.coef_)
print("β0= ",estimademodel.intercept_)
#-----------------------------------------
#bench gradien decent
# Αρχικοποίηση theta
theta = np.zeros((X.shape[1],1))

# Συνάρτηση cost
def calculate_cost(X, y, theta):
    m = len(y)
    return np.sum((X @ theta - y)**2) / (2*m)

# Batch gradient descent
def batch_gradient_descent(X, y, theta, alpha=0.01, iterations=100):
    m = len(y)
    cost_history = []

    for i in range(iterations):
        error = X @ theta - y
        gradient = (1/m) * (X.T @ error)
        theta = theta - alpha * gradient
        cost_history.append(calculate_cost(X, y, theta))

    return theta, cost_history

# Εκτέλεση
theta_final, cost_history = batch_gradient_descent(X, y, theta, alpha=1.01, iterations=100)

print("οι συντελεστες του gradien decent συντελεστές:")
print(theta_final.flatten())

plt.figure(figsize=(8,5))
plt.plot(range(1, len(cost_history)+1), cost_history, color='blue', linewidth=2)
plt.xlabel("Αριθμός επαναλήψεων")
plt.ylabel("Τιμή συνάρτησης κόστους J(θ)")
plt.title("Συνάρτηση κόστους vs αριθμός επαναλήψεων")
plt.grid(True)
plt.show()
